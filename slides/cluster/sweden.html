<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>MeetMagento Sweden 2018 - Building Clustered Application in pure PHP for Magento 2</title>

    <meta name="description" content="Building Clustered Application in pure PHP for Magento 2">
    <meta name="author" content="Ivan Chepurnyi">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <script>
	window.baseUrl = '/bower_components/reveal.js';
	
	window.addJs = function (jsSrc, callback) {
		var script = document.createElement('script');
		script.src = baseUrl + jsSrc;
		script.addEventListener('load', callback || function () {});
		document.getElementsByTagName('body')[0].appendChild(script);
	};
	
	window.addCss = function (cssSrc) {
		var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = baseUrl + cssSrc;
        document.getElementsByTagName('head')[0].appendChild( link );
	}
    </script>

    <!-- Printing and PDF exports -->
    <script>
	    addCss('/css/reveal.css');
		addCss('/css/theme/white.css');
		addCss('/lib/css/zenburn.css');
        addCss((window.location.search.match( /print-pdf/gi ) ? '/css/print/pdf.css' : '/css/print/paper.css'));
    </script>

    <!--[if lt IE 9]>
    <script>
	    addJs('/lib/js/html5shiv.js');
    </script>
    <![endif]-->

	<style type="text/css">
	
section .large {
	font-size: 1.4em;
}

section .x-large {
	font-size: 2.5em;
}

.template {
    display: none;
}

.reveal section footer {
    font-size: 1.0rem;
}

.reveal footer {
    position: absolute;
	top: 0px;
	left: 0px;
	display: block;
	width: 100%;
}

.reveal footer div {
   position: absolute;
}

@media print {
	
	.reveal footer div {
        position: fixed;
	}
	
	.reveal section.title-slide > div {
		margin-top: 20%;
	}
}

.reveal footer .left {
	left: 10px;
	top: 10px;
}

.reveal footer .right {
	top: 10px;
	right: 10px;
}
.reveal pre code {
    font-size: 0.9rem;
	line-height: normal;
}
.reveal section.title-slide {
	height: 100%;
	position: relative;
}

.reveal section.title-slide > div {
	position: absolute;
	top: 30%;
	width: 100%;
}

.reveal section.title-slide > div > * {
	display: block;
    float: left;
}

.reveal section.title-slide img {
	margin: 0;
}

.reveal section.title-slide > div .flex {
	font-size: 1.4rem;
	max-width: 78%;
	padding-left: 10px;
}

.reveal section.title-slide h1 {
	font-size: 3.6em;
	padding-bottom: 10px;
}

.reveal section.title-slide h2 {
	font-size: 2.2em;
	color: #2081C4;
}

.reveal section.title-slide h1, 
.reveal section.title-slide h2,
.reveal section.title-slide p {
	line-height: 0.85;
	margin: 0;
}

.reveal section.title-slide > div .left {
	width: 20%;
}
</style>
<!--[if lt IE 9]>
<script src="lib/js/html5shiv.js"></script>
<![endif]-->
</head>

<body>

<div class="reveal">
	<footer>
        <div class="left">MeetMagento Sweden 2018</div><div class="right">#mm18se</div>
    </footer>
 <!-- Any section element inside of this container is displayed as a slide -->
 <div class="slides">
 
         <section class="title-slide">
           <div>
           	  <div class="left"><img src="/images/logo-icon.svg" class="plain" /></div>
              <div class="flex">
                  <h1>Building Cluster Application</h1>
                  <h2>In pure PHP for Magento 2</h2>
              </div>
           </div>
        </section>        
        
        <section>
			<h2>Once upon a time...</h2>
    		<aside class="notes">
				<p>I want to tell you a story of a very intresting project I did</p>
		   </aside>
     	</section>
       
       <section>
		   <p>A customer was having issues with webshop performance...</p>
	   </section>
       
       <section>
		   <h3>Customer Profile</h3>
		   <ul>
			   <li class="fragment">Fashion retailer</li>
			   <li class="fragment">Magento CE 2.2</li>
			   <li class="fragment">Heavy use of newsletter campaigns</li>
			   <li class="fragment">Sells internationally</li>
		   </ul>
	   </section>
        
       <section>
		   <h2>Customer Issues</h2>
		   <ul>
			   <li class="fragment">Random Deadlocks</li>
               <li class="fragment">Inconsistent Stock Data</li>
		   </ul>
	   </section>
     
       <section>
		   <h3>Problem lies in...</h3>
		   <p class="fragment">...quirks of CatalogInventory implementation</p>
	   </section>
       
       <section>
		   <h3>Random Deadlocks</h3>
		   <p>Locking of stock row records on MySQL side</p>
		   <aside class="notes">
			   <p>When multiple customers buy same product - happens quite often - MySQL goes into stacking locks. At some point it results in deadlock.</p>
		   </aside>
       </section>
       
       <section>
	       	<h3>Inconsistent Stock Data</h3>
   		    <p>Magento has only 1 qty field</p>
   		   <aside class="notes">
			   <p>When stock update comes from ERP, Magento might not yet export some orders. It results in wrong stock QTY. Happens very often.</p>
		   </aside>
       </section>
        
       <section>
		   <h3>Possible solutions?</h3>
   	   </section>
   	   
   	   <section>
		   <h3>Event Sourcing</h3>
      	   <ul>
			   <li class="fragment">Every stock mutation as re-playable event</li>
			   <li class="fragment">No need to lock stock records</li>
			   <li class="fragment">Can distinguish between physical and reserved stock updates</li>
		   </ul>
       </section>
       
       <section>
		   <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 341 259.16" width="80%">
  <defs>
    <symbol id="a" data-name="Org. Chart - Connector" viewBox="0 0 11.39 35.28">
      <path d="M6.69,0V26.14c1.85-1.26,3.05-1.89,4.7-2C8.56,27.06,7.08,30.78,5.7,35.28,4.37,30.78,2.75,27.22,0,24.19a9.87,9.87,0,0,1,4.83,2V0Z" style="fill: #231f20"/>
    </symbol>
  </defs>
  
  <g class="fragment">
    <rect x="3.25" y="0.5" width="134.13" height="42.63" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
    <text transform="translate(10.75 24.81) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">M2 <tspan x="18.35" y="0" style="letter-spacing: 0.009992212956168624em">I</tspan><tspan x="21.34" y="0" style="letter-spacing: -0.013004571273837105em">n</tspan><tspan x="27.84" y="0" style="letter-spacing: -0.009992212956168624em">v</tspan><tspan x="33.49" y="0">e</tspan><tspan x="39.5" y="0" style="letter-spacing: -0.0040409684749211335em">n</tspan><tspan x="46.12" y="0" style="letter-spacing: -0.005987980558292226em">t</tspan><tspan x="50.02" y="0">o</tspan><tspan x="56.6" y="0" style="letter-spacing: 0.025017268467466294em">r</tspan><tspan x="60.83" y="0">y </tspan><tspan x="69.02" y="0" style="letter-spacing: 0.005987980558292226em">M</tspan><tspan x="78.74" y="0" style="letter-spacing: 0.00003673607704473758em">odule</tspan></text>
  </g>
  <g class="fragment">
    <use width="11.39" height="35.28" transform="translate(49.52 42.99)" xlink:href="#a"/>
    <text transform="translate(3.12 61.77)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro;letter-spacing: -0.010986328125em">C<tspan x="5.69" y="0" style="letter-spacing: 0.000048828125em">ommand</tspan></text>
    <rect x="3.25" y="78.27" width="134.13" height="42.63" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
    <text transform="translate(44.99 99.58) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">H<tspan x="7.82" y="0" style="letter-spacing: 0.03798510366425866em">T</tspan><tspan x="14.24" y="0">TP API</tspan><tspan style="font-size: 10px"><tspan x="-13.47" y="12" style="letter-spacing: -0.005995327773701173em">A</tspan><tspan x="-7.41" y="12">sync PHP </tspan><tspan x="32.69" y="12" style="letter-spacing: 0.005995327773701173em">S</tspan><tspan x="37.68" y="12">e</tspan><tspan x="42.69" y="12" style="letter-spacing: 0.024951143528785767em">r</tspan><tspan x="46.21" y="12" style="letter-spacing: -0.010006907386986518em">v</tspan><tspan x="50.92" y="12">er</tspan></tspan></text>
  </g>

  <g class="fragment">
     <use width="11.39" height="35.28" transform="translate(91.36 78.39) rotate(-178.62)" xlink:href="#a"/>
     <text transform="translate(102.17 61.77)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro"><tspan style="letter-spacing: -0.006982421875em">E</tspan><tspan x="4.85" y="0" style="letter-spacing: -0.010009765625em">v</tspan><tspan x="9.56" y="0">e</tspan><tspan x="14.57" y="0" style="letter-spacing: -0.00400390625em">n</tspan><tspan x="20.08" y="0">t</tspan></text>
  </g>
  <g class="fragment">
    <use width="11.39" height="35.28" transform="translate(62.32 120.9) scale(1 1.17)" xlink:href="#a"/>
	<text transform="translate(73.71 141.6)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro"><tspan style="letter-spacing: -0.00302734375em">S</tspan><tspan x="4.9" y="0" style="letter-spacing: -0.006005859375em">t</tspan><tspan x="8.15" y="0" style="letter-spacing: 0.000048828125em">o</tspan><tspan x="13.64" y="0" style="letter-spacing: -0.010009765625em">r</tspan><tspan x="16.81" y="0">es </tspan><tspan x="27.9" y="0" style="letter-spacing: -0.006982421875em">E</tspan><tspan x="32.75" y="0" style="letter-spacing: -0.010009765625em">v</tspan><tspan x="37.46" y="0">e</tspan><tspan x="42.47" y="0" style="letter-spacing: -0.00400390625em">n</tspan><tspan x="47.98" y="0">ts</tspan></text>
    <rect x="0.5" y="194.23" width="135.03" height="64.42" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
    <line x1="0.5" y1="194.23" x2="0.5" y2="162.3" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
    <line x1="135.53" y1="194.23" x2="135.53" y2="162.3" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
    <line x1="0.5" y1="162.3" x2="135.53" y2="162.3" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
    <text transform="translate(32.43 181.84)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro;letter-spacing: -0.006998697916666667em">E<tspan x="5.82" y="0" style="letter-spacing: -0.010009765625em">v</tspan><tspan x="11.47" y="0" style="letter-spacing: 0.000040690104166666664em">e</tspan><tspan x="17.48" y="0" style="letter-spacing: -0.0040283203125em">n</tspan><tspan x="24.1" y="0" style="letter-spacing: 0.000040690104166666664em">t log file</tspan></text>    

  </g>
  <g class="fragment">
    <text transform="translate(11.4 208.88)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro"><tspan style="letter-spacing: -0.00302734375em">S</tspan><tspan x="4.9" y="0" style="letter-spacing: -0.006005859375em">t</tspan><tspan x="8.15" y="0" style="letter-spacing: 0.000048828125em">ock</tspan><tspan x="22.81" y="0" style="letter-spacing: 0.00400390625em">R</tspan><tspan x="28.23" y="0">ese</tspan><tspan x="42.21" y="0" style="letter-spacing: 0.025em">r</tspan><tspan x="45.73" y="0" style="letter-spacing: -0.010009765625em">v</tspan><tspan x="50.44" y="0">ed 1</tspan><tspan x="0" y="12" style="letter-spacing: -0.00498046875em">P</tspan><tspan x="5.27" y="12" style="letter-spacing: -0.01298828125em">h</tspan><tspan x="10.69" y="12" style="letter-spacing: -0.00595703125em">y</tspan><tspan x="15.34" y="12">sical</tspan><tspan x="33.3" y="12" style="letter-spacing: 0.00400390625em">R</tspan><tspan x="38.72" y="12">e</tspan><tspan x="43.73" y="12" style="letter-spacing: -0.00595703125em">c</tspan><tspan x="48.15" y="12">ou</tspan><tspan x="59.15" y="12" style="letter-spacing: -0.003955078125em">n</tspan><tspan x="64.66" y="12" xml:space="preserve">t  4</tspan><tspan x="0" y="24" style="letter-spacing: 0.00400390625em">R</tspan><tspan x="5.42" y="24">ese</tspan><tspan x="19.4" y="24" style="letter-spacing: 0.024951171875em">r</tspan><tspan x="22.92" y="24" style="letter-spacing: -0.00400390625em">va</tspan><tspan x="32.47" y="24" style="letter-spacing: -0.000048828125em">tion</tspan><tspan x="49.16" y="24" style="letter-spacing: -0.006982421875em">C</tspan><tspan x="54.89" y="24">an</tspan><tspan x="65.26" y="24" style="letter-spacing: -0.006005859375em">c</tspan><tspan x="69.68" y="24">eled 4</tspan><tspan x="0" y="36">....</tspan></text>
  </g>
  <g class="fragment">
    <rect x="195.99" y="160.52" width="134.13" height="42.63" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
    <text transform="translate(216.06 178.84) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">D<tspan x="7.99" y="0" style="letter-spacing: -0.003967496320831659em">a</tspan><tspan x="13.73" y="0">tabase</tspan><tspan x="46.86" y="0" style="letter-spacing: -0.03600135550384283em"> </tspan><tspan x="48.97" y="0" style="letter-spacing: -0.032988997186174346em">W</tspan><tspan x="58.73" y="0">o</tspan><tspan x="65.32" y="0" style="letter-spacing: 0.004004232397876397em">r</tspan><tspan x="69.29" y="0" style="letter-spacing: -0.00003673607704473758em">ker</tspan><tspan style="font-size: 10px"><tspan x="3.76" y="12" style="letter-spacing: -0.005995327773701173em">A</tspan><tspan x="9.82" y="12">sync PHP </tspan><tspan x="49.92" y="12" style="letter-spacing: -0.01600223516068769em">P</tspan><tspan x="55.08" y="12" style="letter-spacing: -0.010006907386986518em">r</tspan><tspan x="58.25" y="12" style="letter-spacing: -0.0000440832924536851em">o</tspan><tspan x="63.74" y="12" style="letter-spacing: -0.005995327773701173em">c</tspan><tspan x="68.16" y="12">ess</tspan></tspan></text>
    <text transform="translate(139.95 174) rotate(-0.23)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">I/O<tspan x="12.71" y="0" style="letter-spacing: -0.03603515625em"> </tspan><tspan x="14.47" y="0" style="letter-spacing: -0.0330078125em">W</tspan><tspan x="22.6" y="0" style="letter-spacing: -0.003955078125em">a</tspan><tspan x="27.38" y="0" style="letter-spacing: -0.006005859375em">t</tspan><tspan x="30.63" y="0">cher</tspan></text>
         <use width="11.39" height="35.28" transform="matrix(0, -1, 1.71, -0.01, 135.56, 190.4)" xlink:href="#a"/>

  </g>
  <g  class="fragment">
         <use width="11.39" height="35.28" transform="matrix(-1, 0, 0, -1.12, 268.78, 161.41)" xlink:href="#a"/>
    <rect x="195.99" y="78.73" width="134.13" height="42.63" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
    <text transform="translate(229.36 100.04) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro"><tspan style="letter-spacing: -0.002975622240623744em">S</tspan><tspan x="5.88" y="0" style="letter-spacing: -0.006024716635336963em">t</tspan><tspan x="9.78" y="0" style="letter-spacing: 0.00003673607704473758em">ock</tspan><tspan x="27.37" y="0" style="letter-spacing: -0.040997461981927136em"> </tspan><tspan x="29.42" y="0" style="letter-spacing: -0.06399424621193286em">T</tspan><tspan x="34.62" y="0">ables</tspan><tspan style="font-size: 10px"><tspan x="-2.17" y="12" style="letter-spacing: 0.015958151868234006em">I</tspan><tspan x="0.38" y="12" style="letter-spacing: -0.005951244481247488em">t</tspan><tspan x="3.63" y="12" style="letter-spacing: -0.0000440832924536851em">em and </tspan><tspan x="37.23" y="12" style="letter-spacing: -0.0029976638868505867em">S</tspan><tspan x="42.13" y="12" style="letter-spacing: 0.0000440832924536851em">t</tspan><tspan x="45.44" y="12" style="letter-spacing: -0.004011579613285344em">a</tspan><tspan x="50.22" y="12">tus</tspan></tspan></text>
    <text transform="translate(270.97 145.95)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">Upd<tspan x="17.8" y="0" style="letter-spacing: -0.00400390625em">a</tspan><tspan x="22.58" y="0" style="letter-spacing: -0.006005859375em">t</tspan><tspan x="25.83" y="0">es </tspan><tspan x="36.92" y="0" style="letter-spacing: 0.00400390625em">R</tspan><tspan x="42.34" y="0">e</tspan><tspan x="47.35" y="0" style="letter-spacing: -0.0060546875em">c</tspan><tspan x="51.77" y="0">o</tspan><tspan x="57.26" y="0" style="letter-spacing: -0.0099609375em">r</tspan><tspan x="60.43" y="0">ds</tspan></text>
  </g>
  
  <g  class="fragment">
	  <text transform="translate(198.94 24.81)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">No DB w<tspan x="35.75" y="0" style="letter-spacing: 0.0041015625em">r</tspan><tspan x="39.06" y="0">i</tspan><tspan x="41.4" y="0" style="letter-spacing: -0.00595703125em">t</tspan><tspan x="44.65" y="0">es in </tspan><tspan x="65.75" y="0" style="letter-spacing: 0.0099609375em">I</tspan><tspan x="68.24" y="0" style="letter-spacing: -0.012890625em">n</tspan><tspan x="73.66" y="0" style="letter-spacing: -0.0099609375em">v</tspan><tspan x="78.37" y="0">e</tspan><tspan x="83.38" y="0" style="letter-spacing: -0.00400390625em">n</tspan><tspan x="88.89" y="0" style="letter-spacing: -0.00595703125em">t</tspan><tspan x="92.14" y="0">o</tspan><tspan x="97.63" y="0" style="letter-spacing: 0.025em">r</tspan><tspan x="101.15" y="0">y </tspan><tspan x="107.98" y="0" style="letter-spacing: 0.00595703125em">M</tspan><tspan x="116.08" y="0">odule</tspan></text>
	  <use width="11.39" height="35.28" transform="matrix(-1, 0, 0, -1.12, 268.78, 78.29)" xlink:href="#a"/>
  </g>
</svg>
   	   </section>
   	   
   	   <section>
   	       <svg id="440d2919-0afb-4002-8097-7329c060dcb5" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 405.18 407.62" width="80%">
  <defs>
    <symbol id="ffffe500-ad75-40d1-8527-390ce259c0f3" data-name="Org. Chart - Connector" viewBox="0 0 11.39 35.28">
      <path d="M6.69,0V26.14c1.85-1.26,3.05-1.89,4.7-2C8.56,27.06,7.08,30.78,5.7,35.28,4.37,30.78,2.75,27.22,0,24.19a9.87,9.87,0,0,1,4.83,2V0Z" style="fill: #231f20"/>
    </symbol>
  </defs>
  <rect x="0.5" y="0.5" width="404.18" height="406.62" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
  <text transform="translate(27.86 21.81) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">H<tspan x="7.82" y="0" style="letter-spacing: 0.03798510366425866em">T</tspan><tspan x="14.24" y="0">TP API</tspan><tspan style="font-size: 10px"><tspan x="-13.47" y="12" style="letter-spacing: -0.005995327773701173em">A</tspan><tspan x="-7.41" y="12">sync PHP </tspan><tspan x="32.69" y="12" style="letter-spacing: 0.005995327773701173em">S</tspan><tspan x="37.68" y="12">e</tspan><tspan x="42.69" y="12" style="letter-spacing: 0.024951143528785767em">r</tspan><tspan x="46.21" y="12" style="letter-spacing: -0.010006907386986518em">v</tspan><tspan x="50.92" y="12">er</tspan></tspan></text>
  <g  class="fragment">
    <rect x="24.99" y="53.96" width="134.13" height="42.63" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
    <text transform="translate(53.29 79.01) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro"><tspan style="letter-spacing: -0.013996445354045019em">L</tspan><tspan x="5.5" y="0">oad Balan</tspan><tspan x="54.74" y="0" style="letter-spacing: -0.005987980558292226em">c</tspan><tspan x="60.05" y="0" style="letter-spacing: -0.00003673607704473758em">er</tspan></text>
  </g>
  <g  class="fragment">
    <g>
      <rect x="24.37" y="131.96" width="134.13" height="42.63" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <rect x="32.68" y="140.23" width="134.13" height="42.63" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <rect x="41.62" y="150.66" width="134.13" height="42.63" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <text transform="translate(56.08 174.59) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro"><tspan style="letter-spacing: -0.010984087036376537em">C</tspan><tspan x="6.83" y="0">ommand Handler</tspan></text>
    </g>
    <use width="11.39" height="35.28" transform="translate(80.66 96.59)" xlink:href="#ffffe500-ad75-40d1-8527-390ce259c0f3"/>
    <text transform="translate(94.33 114.23)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">Hashed dist<tspan x="48.87" y="0" style="letter-spacing: 0.00400390625em">r</tspan><tspan x="52.18" y="0">ibution</tspan></text>
  </g>
  <g  class="fragment">
    <line x1="94.33" y1="267.2" x2="94.33" y2="333.57" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10;stroke-width: 2px"/>
    <g>
      <rect x="27.26" y="227.19" width="134.13" height="40.01" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <text transform="translate(49.76 250.24) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro"><tspan style="letter-spacing: -0.007016590715544878em">E</tspan><tspan x="5.82" y="0" style="letter-spacing: -0.009992212956168624em">v</tspan><tspan x="11.47" y="0">e</tspan><tspan x="17.48" y="0" style="letter-spacing: -0.004004232397876397em">n</tspan><tspan x="24.1" y="0">t </tspan><tspan x="30.61" y="0" style="letter-spacing: -0.02597240647062947em">F</tspan><tspan x="36.14" y="0" style="letter-spacing: -0.00003673607704473758em">ile</tspan><tspan x="47.8" y="0" style="letter-spacing: -0.03603809158088757em"> </tspan><tspan x="49.91" y="0" style="letter-spacing: -0.01598019351446085em">W</tspan><tspan x="59.87" y="0" style="letter-spacing: 0.004004232397876397em">r</tspan><tspan x="63.84" y="0">i</tspan><tspan x="66.65" y="0" style="letter-spacing: -0.006024716635336963em">t</tspan><tspan x="70.55" y="0">er</tspan></text>
    </g>
    <use width="11.39" height="35.28" transform="matrix(1, 0.01, -0.01, 0.96, 89.1, 193.25)" xlink:href="#ffffe500-ad75-40d1-8527-390ce259c0f3"/>
    <g>
      <rect x="134.34" y="318.93" width="135.03" height="64.42" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <line x1="134.34" y1="318.93" x2="134.34" y2="287" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <line x1="269.37" y1="318.93" x2="269.37" y2="287" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <line x1="134.34" y1="287" x2="269.37" y2="287" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <text transform="translate(166.28 306.53)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro;letter-spacing: -0.006998697916666667em">E<tspan x="5.82" y="0" style="letter-spacing: -0.010009765625em">v</tspan><tspan x="11.47" y="0" style="letter-spacing: 0.000040690104166666664em">e</tspan><tspan x="17.48" y="0" style="letter-spacing: -0.0040283203125em">n</tspan><tspan x="24.1" y="0" style="letter-spacing: 0.000040690104166666664em">t log file</tspan></text>
      <text transform="translate(145.24 333.57)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro"><tspan style="letter-spacing: -0.00302734375em">S</tspan><tspan x="4.9" y="0" style="letter-spacing: -0.006005859375em">t</tspan><tspan x="8.15" y="0" style="letter-spacing: 0.000048828125em">ock</tspan><tspan x="22.81" y="0" style="letter-spacing: 0.00400390625em">R</tspan><tspan x="28.23" y="0">ese</tspan><tspan x="42.21" y="0" style="letter-spacing: 0.025em">r</tspan><tspan x="45.73" y="0" style="letter-spacing: -0.010009765625em">v</tspan><tspan x="50.44" y="0">ed 1</tspan><tspan x="0" y="12" style="letter-spacing: -0.00498046875em">P</tspan><tspan x="5.27" y="12" style="letter-spacing: -0.01298828125em">h</tspan><tspan x="10.69" y="12" style="letter-spacing: -0.00595703125em">y</tspan><tspan x="15.34" y="12">sical</tspan><tspan x="33.3" y="12" style="letter-spacing: 0.00400390625em">R</tspan><tspan x="38.72" y="12">e</tspan><tspan x="43.73" y="12" style="letter-spacing: -0.00595703125em">c</tspan><tspan x="48.15" y="12">ou</tspan><tspan x="59.15" y="12" style="letter-spacing: -0.003955078125em">n</tspan><tspan x="64.66" y="12" xml:space="preserve">t  4</tspan><tspan x="0" y="24" style="letter-spacing: 0.00400390625em">R</tspan><tspan x="5.42" y="24">ese</tspan><tspan x="19.4" y="24" style="letter-spacing: 0.024951171875em">r</tspan><tspan x="22.92" y="24" style="letter-spacing: -0.00400390625em">va</tspan><tspan x="32.47" y="24" style="letter-spacing: -0.000048828125em">tion</tspan><tspan x="49.16" y="24" style="letter-spacing: -0.006982421875em">C</tspan><tspan x="54.89" y="24">an</tspan><tspan x="65.26" y="24" style="letter-spacing: -0.006005859375em">c</tspan><tspan x="69.68" y="24">eled 4</tspan><tspan x="0" y="36">....</tspan></text>
    </g>
      <use width="11.39" height="35.28" transform="matrix(-0.01, -1, 1.13, -0.01, 94.63, 339.41)" xlink:href="#ffffe500-ad75-40d1-8527-390ce259c0f3"/>
  </g>


  <g  class="fragment">
    
    <use width="11.39" height="35.28" transform="matrix(0.01, 1, -1.8, 0.01, 239.22, 171.1)" xlink:href="#ffffe500-ad75-40d1-8527-390ce259c0f3"/>
    <g>
      <g>
        <rect x="239.38" y="151.01" width="134.13" height="40.01" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
        <text transform="translate(257.47 170.07) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">Snapshot <tspan x="49.7" y="0" style="letter-spacing: -0.002975622240623744em">S</tspan><tspan x="55.58" y="0" style="letter-spacing: -0.005987980558292226em">t</tspan><tspan x="59.48" y="0">o</tspan><tspan x="66.07" y="0" style="letter-spacing: -0.004996106478084312em">r</tspan><tspan x="69.94" y="0" style="letter-spacing: 0.00003673607704473758em">age</tspan><tspan style="font-size: 10px"><tspan x="20.37" y="12" style="letter-spacing: 0.009962824094532833em">I</tspan><tspan x="22.86" y="12">n memo</tspan><tspan x="57.71" y="12" style="letter-spacing: 0.024995226821239454em">r</tspan><tspan x="61.23" y="12">y </tspan></tspan></text>
      </g>
      <use width="11.39" height="35.28" transform="matrix(-0.01, -1, 1.8, -0.01, 175.8, 171.2)" xlink:href="#ffffe500-ad75-40d1-8527-390ce259c0f3"/>
      <text transform="translate(185.2 153.27)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">Ru<tspan x="10.89" y="0" style="letter-spacing: -0.003955078125em">n</tspan><tspan x="16.4" y="0">time</tspan></text>
    </g>
  </g>
  <g  class="fragment">
       <use width="11.39" height="35.28" transform="matrix(-1, 0, 0, -1.02, 312.09, 303.14)" xlink:href="#ffffe500-ad75-40d1-8527-390ce259c0f3"/>
    <line x1="269.37" y1="333.73" x2="306.31" y2="333.51" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10;stroke-width: 2px"/>
    <line x1="306.31" y1="333.57" x2="306.31" y2="267.25" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10;stroke-width: 2px"/>
    <g>
      <rect x="239.25" y="227.24" width="134.13" height="40.01" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <text transform="translate(263.89 250.3) scale(1.11 1)" style="font-size: 14px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro"><tspan style="letter-spacing: 0.003998984386870005em">B</tspan><tspan x="7.64" y="0">ootst</tspan><tspan x="37.83" y="0" style="letter-spacing: -0.005006602500097094em">r</tspan><tspan x="42.34" y="0" style="letter-spacing: 0.000031488066038346504em">apper</tspan></text>
    </g>
    <use width="11.39" height="35.28" transform="matrix(-1, 0, 0, -1.02, 309.89, 227.11)" xlink:href="#ffffe500-ad75-40d1-8527-390ce259c0f3"/>
    <text transform="translate(317.98 306.53)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">On <tspan x="14.56" y="0" style="letter-spacing: -0.002978515625em">S</tspan><tspan x="19.46" y="0" style="letter-spacing: -0.000048828125em">ta</tspan><tspan x="27.59" y="0" style="letter-spacing: 0.023974609375em">r</tspan><tspan x="31.1" y="0">tup</tspan></text>
  </g>
</svg>

       </section>
       
       <section>
		   <p>But what if PHP server fails?</p>
		   <p class="fragment">That is why I build a cluster on top of async app solution</p>
	   </section>
       
       <section>
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 459.52 301.92" width="80%">
 <g class="fragment">
    <rect x="0.5" y="78.21" width="458.52" height="223.2" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
    <text transform="translate(21.27 103.02)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">Clie<tspan x="18.61" y="0" style="letter-spacing: -0.003946940104166667em">n</tspan><tspan x="25.22" y="0">t Side </tspan><tspan x="55.79" y="0" style="letter-spacing: -0.0140380859375em">L</tspan><tspan x="61.28" y="0">oad Balan</tspan><tspan x="110.53" y="0" style="letter-spacing: -0.006022135416666667em">c</tspan><tspan x="115.83" y="0" style="letter-spacing: 0.000040690104166666664em">er </tspan><tspan x="128.31" y="0" style="letter-spacing: -0.0029703776041666665em">A</tspan><tspan x="135.62" y="0">pp</tspan></text>
    <g>
      <rect x="147.16" y="0.5" width="134.13" height="42.63" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <text transform="translate(154.66 24.81) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">M2 <tspan x="18.35" y="0" style="letter-spacing: 0.009992212956168624em">I</tspan><tspan x="21.34" y="0" style="letter-spacing: -0.013004571273837105em">n</tspan><tspan x="27.84" y="0" style="letter-spacing: -0.009992212956168624em">v</tspan><tspan x="33.49" y="0">e</tspan><tspan x="39.5" y="0" style="letter-spacing: -0.0040409684749211335em">n</tspan><tspan x="46.12" y="0" style="letter-spacing: -0.005987980558292226em">t</tspan><tspan x="50.02" y="0">o</tspan><tspan x="56.6" y="0" style="letter-spacing: 0.025017268467466294em">r</tspan><tspan x="60.83" y="0">y </tspan><tspan x="69.02" y="0" style="letter-spacing: 0.005987980558292226em">M</tspan><tspan x="78.74" y="0" style="letter-spacing: 0.00003673607704473758em">odule</tspan></text>
    </g>
    <use width="11.39" height="35.28" transform="translate(193.42 42.99)" xlink:href="#a"/>
    <use width="11.39" height="35.28" transform="translate(235.26 78.39) rotate(-178.62)" xlink:href="#a"/>
    <text transform="translate(147.03 61.77)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro;letter-spacing: -0.010986328125em">C<tspan x="5.69" y="0" style="letter-spacing: 0.000048828125em">ommand</tspan></text>
    <text transform="translate(246.07 61.77)" style="font-size: 10px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro"><tspan style="letter-spacing: -0.006982421875em">E</tspan><tspan x="4.85" y="0" style="letter-spacing: -0.010009765625em">v</tspan><tspan x="9.56" y="0">e</tspan><tspan x="14.57" y="0" style="letter-spacing: -0.00400390625em">n</tspan><tspan x="20.08" y="0">t</tspan></text>
  </g>
    <g>
    
     
     <g>
      <rect x="28.2" y="121.96" width="134.13" height="42.63" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <text transform="translate(69.94 143.28) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">H<tspan x="7.82" y="0" style="letter-spacing: 0.03798510366425866em">T</tspan><tspan x="14.24" y="0">TP API</tspan><tspan style="font-size: 10px"><tspan x="-13.47" y="12" style="letter-spacing: -0.005995327773701173em">A</tspan><tspan x="-7.41" y="12">sync PHP </tspan><tspan x="32.69" y="12" style="letter-spacing: 0.005995327773701173em">S</tspan><tspan x="37.68" y="12">e</tspan><tspan x="42.69" y="12" style="letter-spacing: 0.024951143528785767em">r</tspan><tspan x="46.21" y="12" style="letter-spacing: -0.010006907386986518em">v</tspan><tspan x="50.92" y="12">er</tspan></tspan></text>
    </g>
    <g>
      <rect x="154.92" y="237.09" width="134.13" height="42.63" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <text transform="translate(196.65 258.4) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">H<tspan x="7.82" y="0" style="letter-spacing: 0.03798510366425866em">T</tspan><tspan x="14.24" y="0">TP API</tspan><tspan style="font-size: 10px"><tspan x="-13.47" y="12" style="letter-spacing: -0.005995327773701173em">A</tspan><tspan x="-7.41" y="12">sync PHP </tspan><tspan x="32.69" y="12" style="letter-spacing: 0.005995327773701173em">S</tspan><tspan x="37.68" y="12">e</tspan><tspan x="42.69" y="12" style="letter-spacing: 0.024951143528785767em">r</tspan><tspan x="46.21" y="12" style="letter-spacing: -0.010006907386986518em">v</tspan><tspan x="50.92" y="12">er</tspan></tspan></text>
    </g>
    <g>
      <rect x="283.29" y="121.96" width="134.13" height="42.63" style="fill: #e6e7e8;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10"/>
      <text transform="translate(325.03 143.28) scale(1.11 1)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">H<tspan x="7.82" y="0" style="letter-spacing: 0.03798510366425866em">T</tspan><tspan x="14.24" y="0">TP API</tspan><tspan style="font-size: 10px"><tspan x="-13.47" y="12" style="letter-spacing: -0.005995327773701173em">A</tspan><tspan x="-7.41" y="12">sync PHP </tspan><tspan x="32.69" y="12" style="letter-spacing: 0.005995327773701173em">S</tspan><tspan x="37.68" y="12">e</tspan><tspan x="42.69" y="12" style="letter-spacing: 0.024951143528785767em">r</tspan><tspan x="46.21" y="12" style="letter-spacing: -0.010006907386986518em">v</tspan><tspan x="50.92" y="12">er</tspan></tspan></text>
    </g>
  </g>
    <g class="fragment">
  <text transform="translate(147.16 203.71)" style="font-size: 12px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro"><tspan style="letter-spacing: -0.010986328125em">C</tspan><tspan x="6.83" y="0">onsis</tspan><tspan x="32.39" y="0" style="letter-spacing: -0.006022135416666667em">t</tspan><tspan x="36.29" y="0">e</tspan><tspan x="42.3" y="0" style="letter-spacing: -0.003987630208333333em">n</tspan><tspan x="48.91" y="0">t Hashing Dist</tspan><tspan x="118.69" y="0" style="letter-spacing: 0.004069010416666667em">r</tspan><tspan x="122.66" y="0">ibution</tspan></text>
			  </g>
  <g class="fragment">
  <use width="11.39" height="35.28" transform="translate(87.74 224.24) rotate(180) scale(1 1.69)" xlink:href="#a"/>
  
  <g>
    <line x1="360.36" y1="268.4" x2="289.04" y2="268.05" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10;stroke-width: 2px"/>
    <use width="11.39" height="35.28" transform="translate(366.05 224.24) rotate(180) scale(1 1.69)" xlink:href="#a"/>
    <line x1="360.36" y1="197.09" x2="360.36" y2="268.4" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10;stroke-width: 2px"/>
    <use width="11.39" height="35.28" transform="matrix(-0.01, 1, -1.69, -0.02, 349.58, 253.97)" xlink:href="#a"/>
    <line x1="348.85" y1="259.22" x2="348.42" y2="165.41" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10;stroke-width: 2px"/>
    <text transform="matrix(0, 0.98, -1, 0, 372.73, 178.56)" style="font-size: 12.214075088500977px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">Epoch based sync</text>
  </g>
  <g>
    <line x1="95.54" y1="258.4" x2="95.11" y2="164.59" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10;stroke-width: 2px"/>
    <use width="11.39" height="35.28" transform="matrix(0, -1, 1.69, 0, 95.27, 264.09)" xlink:href="#a"/>
    <line x1="153.85" y1="268.57" x2="82.54" y2="268.23" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10;stroke-width: 2px"/>
    <line x1="82.04" y1="197.09" x2="82.04" y2="268.4" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10;stroke-width: 2px"/>
    <text transform="matrix(-0.01, -0.98, 1, -0.01, 71.54, 263.73)" style="font-size: 12.214075088500977px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">Epoch based sync</text>
  </g>
  <g>
    <line x1="214.22" y1="146.34" x2="283.29" y2="146.34" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10;stroke-width: 2px"/>
    <use width="11.39" height="35.28" transform="matrix(0, 1, -1.59, 0.01, 217.19, 140.46)" xlink:href="#a"/>
    <line x1="231.4" y1="137.74" x2="162.33" y2="138.05" style="fill: none;stroke: #231f20;stroke-linecap: round;stroke-miterlimit: 10;stroke-width: 2px"/>
    <use width="11.39" height="35.28" transform="matrix(-0.01, -1, 1.59, -0.01, 228.46, 143.63)" xlink:href="#a"/>
    <text transform="translate(172.87 131.72) rotate(-0.19) scale(0.98 1)" style="font-size: 12.214075088500977px;fill: #231f20;font-family: MyriadPro-Regular, Myriad Pro">Epoch based sync</text>
  </g>
			  </g>
</svg>

	   </section>
        
       
       <section >
       	   <h3>Why Separate Load Balancer?</h3>
		   <ul>
   		   	   <li class="fragment">Waits till changes are commited to all masters</li>
   		   	   <li class="fragment">Follows redirects from nodes, when failover scenario is invoked</li>
			   <li class="fragment">Keeps client side Magento code simple</li>
		   </ul>
	   </section>
       
        
       <section>
		   <p>Did it solve customer issues?</p>
	   </section>
       
       <section>
		   <h3>Results</h3>
      	   <ul>
			   <li class="fragment">Zero deadlocks in server log</li>
			   <li class="fragment">Customer didn't comaplain about inconsistency</li>
			   <li class="fragment">Low write load on stock tables</li>
			   <li class="fragment">Newsletters result in lower server load</li>
		   </ul>
       </section>
        
	   <section>
            <h1 class="fragment current-visible" data-fragment-index="0">Thank You</h1>
            <h2 class="fragment" data-fragment-index="2">Q&amp;A</h2>
            <p class="fragment twitter" data-fragment-index="2">@IvanChepurnyi</p>
            <p class="fragment email" data-fragment-index="2">ivan@ecomdev.org</p>
       </section>
       
       
              
    </div>
</div>



<script>
	addJs('/lib/js/head.min.js');
	addJs('/js/reveal.js', function () {
		// Full list of configuration options available at:
		// https://github.com/hakimel/reveal.js#configuration
		Reveal.initialize({
			controls: true,
			progress: true,
			history: true,
			center: false,
			transition: 'convex', // none/fade/slide/convex/concave/zoom
			keyboard: {
				66: 'toggleOverview',
				33: function () {
					if (Reveal.isOverview()) {
						return Reveal.navigateLeft();
					}
					
					return Reveal.navigatePrev();
				},
				34: function () {
					if (Reveal.isOverview()) {
						return Reveal.navigateRight();
					}
					
					return Reveal.navigateNext();
				}
			},
			// Optional reveal.js plugins
			dependencies: [
				{ src: baseUrl + '/lib/js/classList.js', condition: function() { return !document.body.classList; } },
				{ src: baseUrl + '/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
				{ src: baseUrl + '/plugin/zoom-js/zoom.js', async: true },
				{ src: baseUrl + '/plugin/notes/notes.js', async: true }
			]
		});
		
		var fixZoom = function () {
			var footer = document.querySelector('.reveal > footer');
			var slides = document.querySelector('.reveal > .slides');
			if (footer && slides) {
				if (slides.style.zoom) {
					footer.style.zoom = slides.style.zoom;
				} else if (slides.style.transform) {
					footer.style.transform = slides.style.transform.replace(/translate\([^\)]+\)/, '');
				}	
			}
		}
		
		Reveal.addEventListener('slidechanged', function () {
			fixZoom();
		});
		
		Reveal.addEventListener('ready', function () {
			var slides = document.querySelectorAll('.reveal section');
			for (var i in slides) {		
				var slide = slides.item(i);
				
				if (slide.classList.contains('title-slide')) {
					continue;
				}
				
				slide.classList.add('center');
			}
			fixZoom();
		});
	});
</script>

</body>
</html>
